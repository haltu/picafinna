// PicaFinna v1.0.1 - Haltu Oy - MIT license
!function(e,t){var i="PicaFinna";e[i]=t(e)}(this,function(e,t){function i(e){var t=e||{};this.resultsPerPage=Math.min(t.resultsPerPage||15,100),this.currentLang=t.locale||"fi",this.imageMaxDimensions=t.imageMaxDimensions||{width:1200,height:1200},this.zIndex=t.zIndex||1e3,this.document=t.documentOverride||document,this.parentElement=t.parentElement||this.document.body,this.searchDebounceTime=t.searchDebounceTime||400,this.useJsonp=t.useJsonp||!0,this._createPickerDOM(),this._attachListeners(),this.resetPicker()}function a(e,t,i){var a;return function(){var n=this,s=arguments,c=function(){a=null,i||e.apply(n,s)},r=i&&!a;clearTimeout(a),a=setTimeout(c,t),r&&e.apply(n,s)}}function n(){}function s(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function c(e){var t=Object.keys(e),i="";return t.forEach(function(t){var a=e[t];Array.isArray(a)||(a=[a]),a.forEach(function(e){i+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)})}),i.substr(1)}function r(i,a){function s(){document.body.removeChild(c),e[r]=n}var c=document.createElement("script"),r="_jsonpCallback";return e._jsonpRequestCallbackCounter===t?e._jsonpRequestCallbackCounter=0:e._jsonpRequestCallbackCounter+=1,r+=e._jsonpRequestCallbackCounter,e[r]=function(e){document.body.removeChild(c),a(e)},i+=(-1==i.indexOf("?")?"?":"&")+"callback="+r,c.src=i,document.body.appendChild(c),{abort:s}}return i.prototype.pickImage=function(e,t){this._imagePickCallback=e,this._searchFieldElement.value=t||"",this._searchApiRequest(this._searchFieldElement.value),this.showPicker()},i.pickImage=function(e,t){var a=new i(t);return a.pickImage(e,(t||{}).initialQuery),a},i.prototype.cancelPick=function(){this._handleImagePicked()},i.prototype.showPicker=function(){this.parentElement.appendChild(this._containerElement),this._searchFieldElement.select()},i.prototype.hidePicker=function(){try{this.parentElement.removeChild(this._containerElement)}catch(e){}},i.prototype.resetPicker=function(){this._currentPage=1,this._currentPageCount=1,this._imagePickCallback=n,this._searchFieldElement.value="",this._searchApiRequest()},i.prototype.setPage=function(e){var t=this._currentPage,i=this._currentPageCount;"prev"==e?e=t-1:"next"==e&&(e=t+1),e=Math.max(e,1),e=Math.min(e,i),this._currentPage=e,this._updatePagination(),this._searchApiRequest(this._searchFieldElement.value,e)},i.prototype._createPickerDOM=function(){var e=this._containerElement=this.document.createElement("div");e.className="picafinna",e.style.zIndex=this.zIndex,e.insertAdjacentHTML("afterbegin",'<div class="picafinna-overlay"></div><div class="picafinna-outer-wrapper"><div class="picafinna-wrapper"><div class="picafinna-header picafinna-wrapper-row"><div class="picafinna-wrapper"><div class="picafinna-wrapper-row"><div class="picafinna-logo-wrapper picafinna-wrapper-cell"><a href="https://finna.fi/" target="_blank" class="picafinna-logo-link"><img class="picafinna-logo-image" src="data:image/svg+xml,'+encodeURIComponent(i.LOGO_SVG)+'" /></a></div><div class="picafinna-search-field-wrapper picafinna-wrapper-cell"><input class="picafinna-field picafinna-search-field" type="text" placeholder="'+this._localize("Search query...")+'" /></div><div class="picafinna-search-buttons-wrapper picafinna-wrapper-cell"><button class="picafinna-btn picafinna-search-btn btn">'+this._localize("Search")+'</button><button class="picafinna-btn picafinna-cancel-btn btn">'+this._localize("Cancel")+'</button></div></div></div></div><div class="picafinna-wrapper-row"><div class="picafinna-wrapper-cell"><div class="picafinna-divider-horizontal"></div></div></div><div class="picafinna-wrapper-row"><div class="picafinna-pagination picafinna-wrapper-cell"><button class="picafinna-prev-page-btn btn">'+this._localize("Previous page")+'</button><div class="picafinna-pagination-text"></div><button class="picafinna-next-page-btn btn">'+this._localize("Next page")+'</button></div></div><div class="picafinna-results picafinna-wrapper-row"><div class="picafinna-wrapper-cell"><div class="picafinna-result-list-wrapper"><div class="picafinna-result-list"></div></div></div></div></div></div>'),this._overlayElement=e.querySelector(".picafinna-overlay"),this._searchFieldElement=e.querySelector(".picafinna-search-field"),this._searchButtonElement=e.querySelector(".picafinna-search-btn"),this._cancelButtonElement=e.querySelector(".picafinna-cancel-btn"),this._paginationTextElement=e.querySelector(".picafinna-pagination-text"),this._prevPageButtonElement=e.querySelector(".picafinna-prev-page-btn"),this._nextPageButtonElement=e.querySelector(".picafinna-next-page-btn"),this._resultListElement=e.querySelector(".picafinna-result-list"),e._setLoadingStatus=function(t){e.className=t?"picafinna picafinna-loading":"picafinna"}},i.prototype._setLoadingStatus=function(e){this._containerElement._setLoadingStatus(e)},i.prototype._createResultItemDOM=function(e){var t,a,n={},s=this.document.createElement("div"),c=this.document.createElement("img"),r=this.document.createElement("div"),l=e.title,o=i.API_BASE_URL+e.images[0],h="https://finna.fi"+e.recordPage,u=e.buildings[0].translated;try{t=e.authors.main}catch(p){t=""}return a=t,a+="\n"+e.imageRights.copyright,e.imageRights.copyright!=e.imageRights.description[0]&&(a+=" – "+e.imageRights.description[0]),a+="\n"+u,n.title=l||"",n.url=o||"",n.pageUrl=h||"",n.licenseDescription=a||"",n.url=n.url.replace("&fullres=1","&w="+this.imageMaxDimensions.width+"&h="+this.imageMaxDimensions.height),s.className="picafinna-result-item",s.appendChild(c),s.appendChild(r),s.style.backgroundImage="url("+o.replace("(","%28").replace(")","%29").replace("&fullres=1","&w=130&h=130")+")",c.className="picafinna-result-image",c.src=o.replace("&fullres=1","&w=130&h=130"),r.className="picafinna-result-attribution",r.setAttribute("title",a),r.appendChild(this.document.createTextNode(a)),s.addEventListener("click",this._handleImagePicked.bind(this,n),!0),s},i.prototype._createStatusTextDOM=function(e){var t=this.document.createElement("div");return t.className="picafinna-result-status",t.appendChild(this.document.createTextNode(e)),t},i.prototype._updatePagination=function(){var e=this._currentResultCount,t=this._currentPage,i=Math.ceil(e/this.resultsPerPage),a=Math.min((t-1)*this.resultsPerPage+1,e),n=Math.min(t*this.resultsPerPage,e);this._prevPageButtonElement.disabled=1>=t?!0:!1,this._nextPageButtonElement.disabled=t>=i?!0:!1,0==e?this._paginationTextElement.innerHTML=this._localize("No search results"):this._paginationTextElement.innerHTML=this._localize("Search results")+" "+(a||"-")+" - "+(n||"-")+" / "+(e||"-"),this._currentPageCount=i},i.prototype._setStatusText=function(e){s(this._resultListElement),this._resultListElement.appendChild(this._createStatusTextDOM(e))},i.prototype._attachListeners=function(){function e(e){this._debouncedSearchApiRequest(this._searchFieldElement.value)}function t(e){this._searchApiRequest(this._searchFieldElement.value)}function i(e){(13==e.which||13==e.keyCode)&&this._searchApiRequest(this._searchFieldElement.value)}function n(e){(27==e.which||27==e.keyCode)&&this.cancelPick()}this._debouncedSearchApiRequest=a(this._searchApiRequest,this.searchDebounceTime),this._overlayElement.addEventListener("click",this.cancelPick.bind(this),!0),this._cancelButtonElement.addEventListener("click",this.cancelPick.bind(this),!0),this._prevPageButtonElement.addEventListener("click",this.setPage.bind(this,"prev")),this._nextPageButtonElement.addEventListener("click",this.setPage.bind(this,"next")),this._searchButtonElement.addEventListener("click",t.bind(this),!0),this._searchFieldElement.addEventListener("input",e.bind(this),!0),this._searchFieldElement.addEventListener("keypress",i.bind(this),!0),this._searchFieldElement.addEventListener("keydown",n.bind(this),!0)},i.prototype._searchApiRequest=function(e,t){var a,n,s,l=this._handleApiResponse.bind(this);if(this._currentPage=t||1,e&&e.trim()){this._setLoadingStatus(!0);try{this._currentApiRequest.abort()}catch(o){}s={"filter[]":['online_boolean:"1"','format:"0/Image/"',"-usage_rights_str_mv:usage_F"],"field[]":["title","imageRights","images","authors","buildings","recordPage"],limit:this.resultsPerPage,page:this._currentPage,lookfor:e},n=i.API_BASE_URL+"/v1/search?"+c(s),this.useJsonp?a=r(n,l):(a=new XMLHttpRequest,a.open("GET",n,!0),a.addEventListener("load",function(){l(JSON.parse(a.responseText))}),a.send()),this._currentApiRequest=a}else this._currentResultCount=0,this._updatePagination(),this._setStatusText(this._localize("#introduction-text"))},i.prototype._handleApiResponse=function(e){this._setLoadingStatus(!1),e.records?(s(this._resultListElement),e.records.forEach(function(e){this._resultListElement.appendChild(this._createResultItemDOM(e))},this)):this._setStatusText(this._localize("No images matching your query were found.")),this._currentResultCount=e.resultCount,this._updatePagination()},i.prototype._handleImagePicked=function(e){this._imagePickCallback&&this._imagePickCallback(e),this.hidePicker()},i.prototype._localize=function(e){var t=i.locale[this.currentLang]||i.locale.en;return t[e]||e},i.API_BASE_URL="https://api.finna.fi",i.LOGO_SVG='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 112.2284 136.12848" width="112.23" height="136.13" style="fill: #00a3ad"><path d="M78.53 29.68l-17.07-8.5c-.24-.13-2.44-1.18-5.4-1.18-1.8 0-3.52.4-5.08 1.18l-17.07 8.5c-.2.1-5.46 2.8-5.46 8.83v31.36c0 .25.07 6.14 5.47 8.83L51 87.2c.25.12 2.44 1.17 5.4 1.17 1.8 0 3.52-.4 5.08-1.18l17.07-8.5c.23-.12 5.47-2.8 5.47-8.84V38.5c0-.24-.06-6.13-5.47-8.82m1.24 40.18c0 3.38-3 4.98-3.12 5.04l-17.07 8.5c-.98.5-2.05.73-3.2.73-1.98 0-3.5-.72-3.5-.72l-10.33-5.13 10.27-5.14c.87 1.17 2.26 1.94 3.83 1.94 2.64 0 4.78-2.14 4.78-4.78V55.36l1.24-.6c.53.5 1.24.83 2.03.83 1.6 0 2.93-1.32 2.93-2.93 0-1.62-1.32-2.93-2.93-2.93-1.6 0-2.93 1.3-2.93 2.93v.04l-1.93.98c-.38.2-.62.58-.62 1v11.58c-.46-.3-.96-.5-1.5-.63v-22.3l6.9-3.46c.52.44 1.2.7 1.9.7 1.63 0 2.94-1.3 2.94-2.92 0-1.6-1.3-2.93-2.93-2.93-1.6 0-2.93 1.32-2.93 2.93 0 .07 0 .14.02.2l-7.18 3.62c-.88-1.03-2.18-1.68-3.64-1.68-2.64 0-4.78 2.14-4.78 4.78V59.7l-1.55.77c-.48-.34-1.06-.54-1.7-.54-1.6 0-2.92 1.3-2.92 2.92 0 1.62 1.3 2.93 2.92 2.93 1.62 0 2.93-1.3 2.93-2.93 0-.15 0-.3-.04-.46l1.98-1c.38-.2.62-.58.62-1V48.6c.45.3.96.5 1.5.62v21.9l-11.73 5.87-4.23-2.1c-3.03-1.5-3.12-4.9-3.12-5.04V38.5c0-3.38 3-4.98 3.12-5.03l17.07-8.5c.97-.5 2.05-.73 3.2-.73 1.97 0 3.5.72 3.5.72l17.08 8.5c3.03 1.5 3.12 4.92 3.12 5.05v31.36zm-23.12-2.04c1.37 0 2.47 1.1 2.47 2.47 0 1.35-1.1 2.46-2.47 2.46-1.36 0-2.47-1.1-2.47-2.47 0-1.38 1.1-2.48 2.47-2.48m-1.18-2.15c-.53.13-1.02.35-1.46.64V49.2c.54-.14 1.03-.35 1.47-.65v17.12zm-2.67-18.6c-1.38 0-2.5-1.1-2.5-2.5 0-1.37 1.12-2.5 2.5-2.5s2.5 1.13 2.5 2.5c0 1.4-1.12 2.5-2.5 2.5m10.53 5.6c0-.76.62-1.37 1.37-1.37.75 0 1.37.6 1.37 1.37 0 .75-.62 1.36-1.37 1.36-.75 0-1.37-.6-1.37-1.36m1.84-15.02c0-.75.6-1.36 1.36-1.36.76 0 1.37.6 1.37 1.35 0 .76-.62 1.37-1.37 1.37-.75 0-1.36-.6-1.36-1.37m-19.03 25.2c0 .76-.6 1.37-1.37 1.37-.75 0-1.36-.6-1.36-1.37 0-.75.62-1.36 1.37-1.36.76 0 1.37.6 1.37 1.35" /><path d="M88.3 109.4h-3.06c.5-1.95 1.03-4.14 1.53-6 .5 1.86 1.02 4.05 1.52 6m3.88 5l-4.2-16.5c-.13-.6-.6-1-1.2-1-.62 0-1.1.4-1.22 1l-4.2 16.5c-.2.76.2 1.47.86 1.66.7.2 1.36-.22 1.55-.93.08-.23.13-.52.2-.83l.56-2.16H89c.2.88.42 1.62.56 2.16.07.3.12.6.2.83.2.7.85 1.13 1.56.93.66-.2 1.05-.9.86-1.67m-19.05 1.7c.55-.15.97-.7.97-1.34v-16.5c0-.76-.55-1.36-1.27-1.36-.7 0-1.26.6-1.26 1.37v10.52c-1.13-2.5-2.34-5.25-3.3-7.4-.6-1.3-1.14-2.5-1.67-3.73-.28-.57-.8-.88-1.4-.74-.62.14-1 .68-1 1.34v16.5c0 .75.57 1.35 1.28 1.35.7 0 1.26-.6 1.26-1.36v-10.52c1.08 2.47 2.34 5.23 3.3 7.4.6 1.27 1.14 2.5 1.67 3.7.24.58.82.9 1.43.75m-18.25 0c.55-.15.97-.7.97-1.34v-16.5c0-.76-.55-1.36-1.26-1.36-.7 0-1.27.6-1.27 1.37v10.52c-1.13-2.5-2.34-5.25-3.3-7.4-.6-1.3-1.14-2.5-1.67-3.73-.28-.57-.8-.88-1.42-.74-.6.14-.97.68-.97 1.34v16.5c0 .75.55 1.35 1.26 1.35.7 0 1.26-.6 1.26-1.36v-10.52c1.07 2.47 2.34 5.23 3.3 7.4.6 1.27 1.14 2.5 1.66 3.7.24.58.82.9 1.42.75m-18.53.02c.7 0 1.26-.6 1.26-1.36v-16.5c0-.76-.54-1.36-1.25-1.36-.7 0-1.26.6-1.26 1.37v16.5c0 .75.54 1.35 1.25 1.35m-15.1-.1c.72 0 1.27-.6 1.27-1.38v-7.05H26c.7 0 1.26-.6 1.26-1.37 0-.77-.56-1.37-1.27-1.37H22.5v-5.12h4c.7 0 1.26-.6 1.26-1.36 0-.77-.55-1.37-1.26-1.37h-5.26c-.7 0-1.26.6-1.26 1.38v16.26c0 .77.55 1.37 1.26 1.37" /></svg>',i.locale={},i.locale.en={Search:"Search",Cancel:"Cancel","Previous page":"Previous page","Next page":"Next page","Search results":"Search results","No search results":"No search results","No images matching your query were found.":"No images matching your query were found.","Search query...":"Search Finna for word...","#introduction-text":"Find the relevant images from Finna materials provided by Finnish libraries, archives and museums."},i.locale.fi={Search:"Hae",Cancel:"Peruuta","Previous page":"Edellinen sivu","Next page":"Seuraava sivu","Search results":"Hakutulokset","No search results":"Ei hakutuloksia","No images matching your query were found.":"Hakua vastaavia kuvia ei löytynyt.","Search query...":"Etsi hakusanalla Finnasta...","#introduction-text":"Löydä tarvitsemasi kuvat Finnan kuva-aineistoista. Käytettävissäsi ovat Suomen museoiden, kirjastojen ja arkistojen aarteet!"},i});
