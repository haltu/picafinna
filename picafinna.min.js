// PicaFinna v1.1.3 - Haltu Oy - MIT license
!function(a,b){var c="PicaFinna";a[c]=b(a)}(this,function(a,b){function c(a){var c=a||{};this.resultsPerPage=Math.min(c.resultsPerPage||15,100),this.currentLang=c.locale||"fi",this.imageMaxDimensions=c.imageMaxDimensions||{width:1200,height:1200},this.zIndex=c.zIndex||1e3,this.document=c.documentOverride||document,this.parentElement=c.parentElement||this.document.body,this.searchDebounceTime=c.searchDebounceTime||400,this.useJsonp=c.useJsonp||!0,this.allowImagePick=c.allowImagePick!==!1,this.allowPagePick=c.allowPagePick!==!1,this._createPickerDOM(),this._attachListeners(),this.resetPicker()}function d(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function e(){}function f(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function h(a){var b=Object.keys(a),c="";return b.forEach(function(d){var e=a[d];Array.isArray(e)||(e=[e]),e.forEach(function(b){c+="&"+encodeURIComponent(d)+"="+encodeURIComponent(b)})}),c.substr(1)}function i(c,d){function h(){document.body.removeChild(f),a[g]=e}var f=document.createElement("script"),g="_jsonpCallback";return a._jsonpRequestCallbackCounter===b?a._jsonpRequestCallbackCounter=0:a._jsonpRequestCallbackCounter+=1,g+=a._jsonpRequestCallbackCounter,a[g]=function(b){document.body.removeChild(f),d(b)},c+=(c.indexOf("?")==-1?"?":"&")+"callback="+g,f.src=c,document.body.appendChild(f),{abort:h}}return c.prototype.pickImage=function(b,c){this._imagePickCallback=b,this._searchFieldElement.value=c||"",this._searchApiRequest(this._searchFieldElement.value),this.showPicker()},c.pickImage=function(b,d){var e=new c(d);return e.pickImage(b,(d||{}).initialQuery),e},c.prototype.cancelPick=function(){this._handleImagePicked()},c.prototype.showPicker=function(){this.parentElement.appendChild(this._containerElement),this._searchFieldElement.select()},c.prototype.hidePicker=function(){try{this.parentElement.removeChild(this._detailPageElement)}catch(a){}try{this.parentElement.removeChild(this._containerElement)}catch(a){}},c.prototype.resetPicker=function(){this._currentPage=1,this._currentPageCount=1,this._imagePickCallback=e,this._searchFieldElement.value="",this._searchApiRequest()},c.prototype.setPage=function(b){var c=this._currentPage,d=this._currentPageCount;"prev"==b?b=c-1:"next"==b&&(b=c+1),b=Math.max(b,1),b=Math.min(b,d),this._currentPage=b,this._updatePagination(),this._searchApiRequest(this._searchFieldElement.value,b)},c.prototype._createPickerDOM=function(){var b=this._containerElement=this.document.createElement("div");b.className="picafinna",b.style.zIndex=this.zIndex,b.insertAdjacentHTML("afterbegin",'<div class="picafinna-overlay"></div><div class="picafinna-outer-wrapper"><div class="picafinna-wrapper"><div class="picafinna-header picafinna-wrapper-row"><div class="picafinna-wrapper"><div class="picafinna-wrapper-row"><div class="picafinna-logo-wrapper picafinna-wrapper-cell"><a href="https://finna.fi/" target="_blank" class="picafinna-logo-link"><img class="picafinna-logo-image" src="data:image/svg+xml,'+encodeURIComponent(c.LOGO_SVG)+'" /></a></div><div class="picafinna-search-field-wrapper picafinna-wrapper-cell"><input class="picafinna-field picafinna-search-field" type="text" placeholder="'+this._localize("Search query...")+'" /></div><div class="picafinna-search-buttons-wrapper picafinna-wrapper-cell"><button class="picafinna-btn picafinna-search-btn btn">'+this._localize("Search")+'</button><button class="picafinna-btn picafinna-cancel-btn btn">'+this._localize("Cancel")+'</button></div></div></div></div><div class="picafinna-wrapper-row"><div class="picafinna-wrapper-cell"><div class="picafinna-divider-horizontal"></div></div></div><div class="picafinna-wrapper-row"><div class="picafinna-pagination picafinna-wrapper-cell"><button class="picafinna-prev-page-btn btn">'+this._localize("Previous page")+'</button><div class="picafinna-pagination-text"></div><button class="picafinna-next-page-btn btn">'+this._localize("Next page")+'</button></div></div><div class="picafinna-results picafinna-wrapper-row"><div class="picafinna-wrapper-cell"><div class="picafinna-result-list-wrapper"><div class="picafinna-result-list"></div></div></div></div></div></div>'),this._overlayElement=b.querySelector(".picafinna-overlay"),this._searchFieldElement=b.querySelector(".picafinna-search-field"),this._searchButtonElement=b.querySelector(".picafinna-search-btn"),this._cancelButtonElement=b.querySelector(".picafinna-cancel-btn"),this._paginationTextElement=b.querySelector(".picafinna-pagination-text"),this._prevPageButtonElement=b.querySelector(".picafinna-prev-page-btn"),this._nextPageButtonElement=b.querySelector(".picafinna-next-page-btn"),this._resultListElement=b.querySelector(".picafinna-result-list"),b._setLoadingStatus=function(c){b.className=c?"picafinna picafinna-loading":"picafinna"}},c.prototype._createImageDetailDOM=function(b){var d=this.document.createElement("div"),e="",f="",g="",h="",i="",j="";this.allowImagePick&&(e='<button class="picafinna-use-image-btn btn">'+this._localize("Use image")+'</button><div class="picafinna-pagination-text"></div>'),this.allowPagePick&&(f='<button class="picafinna-use-page-btn btn">'+this._localize("Use as material link")+"</button>"),b.year&&(g=", "+b.year),b.organization&&(imageOrganization="<dt>"+this._localize("Organization")+":</dt><dd>"+b.organization+"</dd>"),b.collections&&(h="<dt>"+this._localize("Collections")+":</dt><dd>"+b.collections+"</dd>"),b.measurements&&(i="<dt>"+this._localize("Measurements")+":</dt><dd>"+b.measurements+"</dd>"),b.summary&&(j='<p class="picafinna-detail-paragraph">'+b.summary+"</p>"),d.className="picafinna picafinna-detail",d.style.zIndex=this.zIndex+1,d.insertAdjacentHTML("afterbegin",'<div class="picafinna-outer-wrapper"><div class="picafinna-wrapper"><span class="picafinna-close-details"><img src="data:image/svg+xml,'+encodeURIComponent(c.ARROW_BACK)+'" /></span><div class="picafinna-details-container"><div class="picafinna-details-left-side"><img class="picafinna-detail-image" src="'+b.url+'"></img><p class="picafinna-detail-image-text">'+b.licenseDescription+'</p></div><div class="picafinna-details-right-side"><p class="picafinna-detail-image-text">'+b.formats+g+'</p><h1 class="picafinna-detail-title" title="'+b.title+'"><a href="'+b.pageUrl+'">'+b.title+"</a></h1>"+j+'<dl class="picafinna-detail-meta">'+imageOrganization+h+i+'</dl></div></div><div class="picafinna-wrapper-row"><div class="picafinna-wrapper-cell"><div class="picafinna-divider-horizontal"></div></div></div><div class="picafinna-wrapper-row"><div class="picafinna-pagination picafinna-wrapper-cell">'+e+f+"</div></div></div></div>"),this._closeButtonElement=d.querySelector(".picafinna-close-details"),this._useImageButton=d.querySelector(".picafinna-use-image-btn"),this._usePageButton=d.querySelector(".picafinna-use-page-btn"),this.imageObj=b,this.parentElement.appendChild(d),this._detailPageElement=d,this._attachDetailListeners()},c.prototype._setLoadingStatus=function(b){this._containerElement._setLoadingStatus(b)},c.prototype._createResultItemDOM=function(b){var q,r,d={},e=this.document.createElement("div"),f=this.document.createElement("img"),g=this.document.createElement("div"),h=b.title,i=c.API_BASE_URL+b.images[0],j="https://finna.fi"+b.recordPage,k=b.buildings[0].translated,l=b.formats[0].translated,m=b.year,n=b.collections,o=b.measurements,p=b.summary;try{q=b.authors.main}catch(a){q=""}return r=q,r+="\n"+b.imageRights.copyright,b.imageRights.description&&b.imageRights.copyright!=b.imageRights.description[0]&&(r+=" – "+b.imageRights.description[0]),r+="\n"+k,d.title=h||"",d.url=i||"",d.pageUrl=j||"",d.licenseDescription=r||"",d.organization=k||"",d.formats=l||"",d.year=m||"",d.collections=n||"",d.measurements=o||"",d.summary=p||"",d.url=d.url.replace("&fullres=1","&w="+this.imageMaxDimensions.width+"&h="+this.imageMaxDimensions.height),e.className="picafinna-result-item",e.appendChild(f),e.appendChild(g),e.style.backgroundImage="url("+i.replace("(","%28").replace(")","%29").replace("&fullres=1","&w=130&h=130")+")",f.className="picafinna-result-image",f.src=i.replace("&fullres=1","&w=130&h=130"),g.className="picafinna-result-attribution",g.setAttribute("title",d.title+" "+d.year),g.appendChild(this.document.createTextNode(d.title+" "+d.year)),e.addEventListener("click",this._createImageDetailDOM.bind(this,d),!0),e},c.prototype._createStatusTextDOM=function(b){var c=this.document.createElement("div");return c.className="picafinna-result-status",c.appendChild(this.document.createTextNode(b)),c},c.prototype._updatePagination=function(){var b=this._currentResultCount,c=this._currentPage,d=Math.ceil(b/this.resultsPerPage),e=Math.min((c-1)*this.resultsPerPage+1,b),f=Math.min(c*this.resultsPerPage,b);this._prevPageButtonElement.disabled=c<=1,this._nextPageButtonElement.disabled=c>=d,0==b?this._paginationTextElement.innerHTML=this._localize("No search results"):this._paginationTextElement.innerHTML=this._localize("Search results")+" "+(e||"-")+" - "+(f||"-")+" / "+(b||"-"),this._currentPageCount=d},c.prototype._setStatusText=function(b){f(this._resultListElement),this._resultListElement.appendChild(this._createStatusTextDOM(b))},c.prototype._attachListeners=function(){function b(a){this._debouncedSearchApiRequest(this._searchFieldElement.value)}function c(a){this._searchApiRequest(this._searchFieldElement.value)}function e(a){13!=a.which&&13!=a.keyCode||this._searchApiRequest(this._searchFieldElement.value)}function f(a){27!=a.which&&27!=a.keyCode||this.cancelPick()}this._debouncedSearchApiRequest=d(this._searchApiRequest,this.searchDebounceTime),this._overlayElement.addEventListener("click",this.cancelPick.bind(this),!0),this._cancelButtonElement.addEventListener("click",this.cancelPick.bind(this),!0),this._prevPageButtonElement.addEventListener("click",this.setPage.bind(this,"prev")),this._nextPageButtonElement.addEventListener("click",this.setPage.bind(this,"next")),this._searchButtonElement.addEventListener("click",c.bind(this),!0),this._searchFieldElement.addEventListener("input",b.bind(this),!0),this._searchFieldElement.addEventListener("keypress",e.bind(this),!0),this._searchFieldElement.addEventListener("keydown",f.bind(this),!0)},c.prototype._attachDetailListeners=function(){function b(a){this.parentElement.removeChild(this._detailPageElement)}this._closeButtonElement.addEventListener("click",b.bind(this),!0),this._useImageButton&&this._useImageButton.addEventListener("click",this._handleImagePicked.bind(this,this.imageObj),!0),this._usePageButton&&this._usePageButton.addEventListener("click",this._handlePagePicked.bind(this,this.imageObj),!0)},c.prototype._searchApiRequest=function(b,d){var f,g,j,e=this._handleApiResponse.bind(this);if(this._currentPage=d||1,b&&b.trim()){this._setLoadingStatus(!0);try{this._currentApiRequest.abort()}catch(a){}j={"filter[]":['online_boolean:"1"',"usage_rights_str_mv:usage_E"],"field[]":["title","imageRights","images","authors","buildings","formats","year","collections","measurements","summary","recordPage"],limit:this.resultsPerPage,page:this._currentPage,lookfor:b},g=c.API_BASE_URL+"/v1/search?"+h(j),this.useJsonp?f=i(g,e):(f=new XMLHttpRequest,f.open("GET",g,!0),f.addEventListener("load",function(){e(JSON.parse(f.responseText))}),f.send()),this._currentApiRequest=f}else this._currentResultCount=0,this._updatePagination(),this._setStatusText(this._localize("#introduction-text"))},c.prototype._handleApiResponse=function(b){this._setLoadingStatus(!1),b.records?(f(this._resultListElement),b.records.forEach(function(b){this._resultListElement.appendChild(this._createResultItemDOM(b))},this)):this._setStatusText(this._localize("No images matching your query were found.")),this._currentResultCount=b.resultCount,this._updatePagination()},c.prototype._handleImagePicked=function(b){b&&(b.pageUrl=""),this._imagePickCallback&&this._imagePickCallback(b),this.hidePicker()},c.prototype._handlePagePicked=function(b){b&&(b.url=""),this._imagePickCallback&&this._imagePickCallback(b),this.hidePicker()},c.prototype._localize=function(b){var d=c.locale[this.currentLang]||c.locale.en;return d[b]||b},c.API_BASE_URL="https://api.finna.fi",c.LOGO_SVG='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 112.2284 136.12848" width="112.23" height="136.13" style="fill: #00a3ad"><path d="M78.53 29.68l-17.07-8.5c-.24-.13-2.44-1.18-5.4-1.18-1.8 0-3.52.4-5.08 1.18l-17.07 8.5c-.2.1-5.46 2.8-5.46 8.83v31.36c0 .25.07 6.14 5.47 8.83L51 87.2c.25.12 2.44 1.17 5.4 1.17 1.8 0 3.52-.4 5.08-1.18l17.07-8.5c.23-.12 5.47-2.8 5.47-8.84V38.5c0-.24-.06-6.13-5.47-8.82m1.24 40.18c0 3.38-3 4.98-3.12 5.04l-17.07 8.5c-.98.5-2.05.73-3.2.73-1.98 0-3.5-.72-3.5-.72l-10.33-5.13 10.27-5.14c.87 1.17 2.26 1.94 3.83 1.94 2.64 0 4.78-2.14 4.78-4.78V55.36l1.24-.6c.53.5 1.24.83 2.03.83 1.6 0 2.93-1.32 2.93-2.93 0-1.62-1.32-2.93-2.93-2.93-1.6 0-2.93 1.3-2.93 2.93v.04l-1.93.98c-.38.2-.62.58-.62 1v11.58c-.46-.3-.96-.5-1.5-.63v-22.3l6.9-3.46c.52.44 1.2.7 1.9.7 1.63 0 2.94-1.3 2.94-2.92 0-1.6-1.3-2.93-2.93-2.93-1.6 0-2.93 1.32-2.93 2.93 0 .07 0 .14.02.2l-7.18 3.62c-.88-1.03-2.18-1.68-3.64-1.68-2.64 0-4.78 2.14-4.78 4.78V59.7l-1.55.77c-.48-.34-1.06-.54-1.7-.54-1.6 0-2.92 1.3-2.92 2.92 0 1.62 1.3 2.93 2.92 2.93 1.62 0 2.93-1.3 2.93-2.93 0-.15 0-.3-.04-.46l1.98-1c.38-.2.62-.58.62-1V48.6c.45.3.96.5 1.5.62v21.9l-11.73 5.87-4.23-2.1c-3.03-1.5-3.12-4.9-3.12-5.04V38.5c0-3.38 3-4.98 3.12-5.03l17.07-8.5c.97-.5 2.05-.73 3.2-.73 1.97 0 3.5.72 3.5.72l17.08 8.5c3.03 1.5 3.12 4.92 3.12 5.05v31.36zm-23.12-2.04c1.37 0 2.47 1.1 2.47 2.47 0 1.35-1.1 2.46-2.47 2.46-1.36 0-2.47-1.1-2.47-2.47 0-1.38 1.1-2.48 2.47-2.48m-1.18-2.15c-.53.13-1.02.35-1.46.64V49.2c.54-.14 1.03-.35 1.47-.65v17.12zm-2.67-18.6c-1.38 0-2.5-1.1-2.5-2.5 0-1.37 1.12-2.5 2.5-2.5s2.5 1.13 2.5 2.5c0 1.4-1.12 2.5-2.5 2.5m10.53 5.6c0-.76.62-1.37 1.37-1.37.75 0 1.37.6 1.37 1.37 0 .75-.62 1.36-1.37 1.36-.75 0-1.37-.6-1.37-1.36m1.84-15.02c0-.75.6-1.36 1.36-1.36.76 0 1.37.6 1.37 1.35 0 .76-.62 1.37-1.37 1.37-.75 0-1.36-.6-1.36-1.37m-19.03 25.2c0 .76-.6 1.37-1.37 1.37-.75 0-1.36-.6-1.36-1.37 0-.75.62-1.36 1.37-1.36.76 0 1.37.6 1.37 1.35" /><path d="M88.3 109.4h-3.06c.5-1.95 1.03-4.14 1.53-6 .5 1.86 1.02 4.05 1.52 6m3.88 5l-4.2-16.5c-.13-.6-.6-1-1.2-1-.62 0-1.1.4-1.22 1l-4.2 16.5c-.2.76.2 1.47.86 1.66.7.2 1.36-.22 1.55-.93.08-.23.13-.52.2-.83l.56-2.16H89c.2.88.42 1.62.56 2.16.07.3.12.6.2.83.2.7.85 1.13 1.56.93.66-.2 1.05-.9.86-1.67m-19.05 1.7c.55-.15.97-.7.97-1.34v-16.5c0-.76-.55-1.36-1.27-1.36-.7 0-1.26.6-1.26 1.37v10.52c-1.13-2.5-2.34-5.25-3.3-7.4-.6-1.3-1.14-2.5-1.67-3.73-.28-.57-.8-.88-1.4-.74-.62.14-1 .68-1 1.34v16.5c0 .75.57 1.35 1.28 1.35.7 0 1.26-.6 1.26-1.36v-10.52c1.08 2.47 2.34 5.23 3.3 7.4.6 1.27 1.14 2.5 1.67 3.7.24.58.82.9 1.43.75m-18.25 0c.55-.15.97-.7.97-1.34v-16.5c0-.76-.55-1.36-1.26-1.36-.7 0-1.27.6-1.27 1.37v10.52c-1.13-2.5-2.34-5.25-3.3-7.4-.6-1.3-1.14-2.5-1.67-3.73-.28-.57-.8-.88-1.42-.74-.6.14-.97.68-.97 1.34v16.5c0 .75.55 1.35 1.26 1.35.7 0 1.26-.6 1.26-1.36v-10.52c1.07 2.47 2.34 5.23 3.3 7.4.6 1.27 1.14 2.5 1.66 3.7.24.58.82.9 1.42.75m-18.53.02c.7 0 1.26-.6 1.26-1.36v-16.5c0-.76-.54-1.36-1.25-1.36-.7 0-1.26.6-1.26 1.37v16.5c0 .75.54 1.35 1.25 1.35m-15.1-.1c.72 0 1.27-.6 1.27-1.38v-7.05H26c.7 0 1.26-.6 1.26-1.37 0-.77-.56-1.37-1.27-1.37H22.5v-5.12h4c.7 0 1.26-.6 1.26-1.36 0-.77-.55-1.37-1.26-1.37h-5.26c-.7 0-1.26.6-1.26 1.38v16.26c0 .77.55 1.37 1.26 1.37" /></svg>',c.ARROW_BACK='<svg xmlns="http://www.w3.org/2000/svg" width="35" height="29" style="fill: #000"><path d="M 7.24923,21.750905 -0.00151152,14.451446 7.2727602,7.2257232 C 15.936113,-1.3798106 18,-1.9256431 18,4.3887091 c 0,4.2290091 0.128139,4.4127481 3.521381,5.0493241 3.980666,0.7467778 9.86293,5.4706758 12.029702,9.6607508 C 34.347987,20.639827 35,23.544644 35,25.553932 l 0,3.653252 -3.611091,-3.170579 C 27.394038,22.529061 24.08684,21 20.495266,21 c -2.021004,0 -2.420744,0.557079 -2.684901,3.741683 -0.195263,2.354047 -0.866659,3.846821 -1.810379,4.025182 -0.825008,0.155924 -4.762848,-3.001259 -8.750756,-7.01596 z" /></svg>',c.locale={},c.locale.en={Search:"Search",Cancel:"Cancel","Previous page":"Previous page","Next page":"Next page","Search results":"Search results","No search results":"No search results","No images matching your query were found.":"No images matching your query were found.","Search query...":"Search Finna for word...","#introduction-text":"Find the relevant images from Finna materials provided by Finnish libraries, archives and museums."},c.locale.fi={Search:"Hae",Cancel:"Peruuta","Previous page":"Edellinen sivu","Next page":"Seuraava sivu","Search results":"Hakutulokset","No search results":"Ei hakutuloksia","No images matching your query were found.":"Hakua vastaavia kuvia ei löytynyt.","Search query...":"Etsi hakusanalla Finnasta...","#introduction-text":"Löydä tarvitsemasi kuvat Finnan kuva-aineistoista. Käytettävissäsi ovat Suomen museoiden, kirjastojen ja arkistojen aarteet!"},c});
